{
  "app-id": "com.rechain.online",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "23.08",
  "sdk": "org.freedesktop.Sdk",
  "command": "rechainonline",
  "separate-locales": false,
  "finish-args": [
    "--share=ipc",
    "--socket=fallback-x11",
    "--socket=wayland",
    "--socket=pulseaudio",
    "--share=network",
    "--device=all",
    "--filesystem=xdg-download",
    "--talk-name=org.freedesktop.Notifications",
    "--own-name=com.rechain.online",
    "--env=LD_LIBRARY_PATH=/app/lib:/app/lib/plugins:$LD_LIBRARY_PATH"
  ],
  "modules": [
	{
	  "name": "python3-modules",
	  "buildsystem": "simple",
	  "build-commands": [
	    "python3 -m pip install --no-index --find-links=. --prefix=/app flit_core-3.7.0.tar.gz",
	    "python3 -m pip install --no-index --find-links=. --prefix=/app packaging-23.1.tar.gz"
	  ],
	  "sources": [
	    { "type": "file", "path": "flit_core-3.7.0.tar.gz" },
	    { "type": "file", "path": "packaging-23.1.tar.gz" }
	  ]
	},
    {
      "name": "glib",
      "buildsystem": "meson",
      "config-opts": [
        "-Dlibmount=auto",
        "-Ddefault_library=shared",
        "-Dgtk_doc=false"
      ],
      "build-options": {
        "env": {
          "PYTHONPATH": "/app/lib/python3.12/site-packages"
        }
      },
      "sources": [
        {
          "type": "archive",
          "url": "https://download.gnome.org/sources/glib/2.80/glib-2.80.3.tar.xz",
          "sha256": "3947a0eaddd0f3613d0230bb246d0c69e46142c19022f5c4b1b2e3cba236d417"
        }
      ],
      "post-build": [
        "pip3 install --prefix=/app packaging"
      ]
    },
    {
      "name": "libjsoncpp",
      "buildsystem": "meson",
      "config-opts": [
        "--buildtype=release",
        "--default-library=shared"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/open-source-parsers/jsoncpp/archive/refs/tags/1.9.5.tar.gz",
          "sha256": "f409856e5920c18d0c2fb85276e24ee607d2a09b5e7d5f0a371368903c275da2"
        }
      ]
    },
    {
      "name": "olm",
      "buildsystem": "cmake",
      "sources": [
        {
          "type": "git",
          "url": "https://gitlab.matrix.org/matrix-org/olm.git",
          "tag": "3.2.14"
        }
      ]
    },
    {
      "name": "libsecret",
      "buildsystem": "meson",
      "config-opts": [
        "-Dvapi=false",
        "-Dgtk_doc=false"
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://gitlab.gnome.org/GNOME/libsecret.git",
          "tag": "0.20.5"
        }
      ]
    },
    {
      "name": "sqlite",
      "buildsystem": "autotools",
      "sources": [
        {
          "type": "archive",
          "url": "https://www.sqlite.org/2024/sqlite-autoconf-3460100.tar.gz",
          "sha256": "67d3fe6d268e6eaddcae3727fce58fcc8e9c53869bdd07a0c61e38ddf2965071"
        }
      ]
    },
    {
      "name": "REChain",
      "buildsystem": "simple",
      "only-arches": ["x86_64", "aarch64"],
      "build-commands": [
        "cp -r REChain /app/REChain",
        "chmod +x /app/REChain/rechainonline",
        "install -Dm755 /app/REChain/rechainonline /app/bin/rechainonline",
        "install -Dm644 logo.svg /app/share/icons/hicolor/scalable/apps/com.rechain.online.svg",
        "install -Dm644 com.rechain.online.desktop /app/share/applications/com.rechain.online.desktop",
        "install -Dm644 com.rechain.online.metainfo.xml /app/share/metainfo/com.rechain.online.metainfo.xml"
      ],
      "build-options": {
        "env": {
          "PKG_CONFIG_PATH": "/app/lib/pkgconfig:/app/share/pkgconfig",
          "CFLAGS": "-I/app/include",
          "LDFLAGS": "-L/app/lib -Wl,-rpath=/app/lib"
        }
      },
      "sources": [
        {
          "type": "archive",
          "only-arches": ["x86_64", "aarch64"],
          "url": "https://github.com/sorydima/REChain-/releases/download/4.1.8%2B1152/REChain.Online.tar.gz",
          "sha256": "e5d9b9c7ad648ad2c694e9e8f8779a9bcc7004e4309dc7ac5bc5f35ad5731e33",
          "dest": "REChain"
        },
        { "type": "file", "path": "com.rechain.online.metainfo.xml" },
        { "type": "file", "path": "com.rechain.online.desktop" },
        { "type": "file", "path": "logo.svg" }
      ]
    },
    {
      "name": "flutter-plugins",
      "buildsystem": "simple",
      "only-arches": ["x86_64", "aarch64"],
      "build-commands": [
        "mkdir -p /app/lib/plugins",
        "if [ \"$ARCH\" = \"x86_64\" ]; then cp build/linux/x64/release/bundle/lib/*.so /app/lib/plugins/; fi",
        "if [ \"$ARCH\" = \"aarch64\" ]; then cp build/linux/arm64/release/bundle/lib/*.so /app/lib/plugins/; fi"
      ],
      "sources": []
    }
  ]
}

