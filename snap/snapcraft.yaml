name: rechainonline
title: REChain
base: core20
version: 4.1.7
license: AGPL-3.0
summary: The inclusion of polls enhances decision-making processes.
description: |
  REChain is a comprehensive platform that unifies Matrix protocol, blockchain, IPFS, AI, and external services into a seamless, extensible, and developer-friendly ecosystem. It empowers users and developers to build, scale, and secure decentralized apps, bots, and integrations for the future of the internet.

  ## Features
  - Matrix, Blockchain (TON, Ethereum, Web3), IPFS, AI & Analytics, REST/gRPC, Encryption
  - Flutter-based responsive UI
  - Messaging, files, voice, location, notifications, public/private chats, dark mode, stickers
  - Matrix federation, video calls (Jitsi), end-to-end encryption, emoji verification
  - Compatible with Element, Nheko, NeoChat

  ## Dream
  Imagine a world where anyone can chat freely without corporate surveillance.
  Join the community: https://matrix.to/#/#chatting:matrix.katya.wtf
  Website: http://online.rechain.network
  Microblog: https://instagram.com/rechain_inc

grade: stable
confinement: strict

parts:
  flutter-git:
    source: https://github.com/flutter/flutter.git
    source-tag: 3.32.5
    source-depth: 1
    plugin: nil
    override-build: |
      set -e
      INSTALL_DIR="${CRAFT_PART_INSTALL:-$SNAPCRAFT_PART_INSTALL}"
      SRC_DIR="${CRAFT_PART_SRC:-$SNAPCRAFT_PART_SRC}"

      mkdir -p "$INSTALL_DIR/usr/bin"
      mkdir -p "$INSTALL_DIR/usr/libexec"

      cp -r "$SRC_DIR" "$INSTALL_DIR/usr/libexec/flutter"
      ln -s "$INSTALL_DIR/usr/libexec/flutter/bin/flutter" "$INSTALL_DIR/usr/bin/flutter"
      ln -s "$INSTALL_DIR/usr/libexec/flutter/bin/dart" "$INSTALL_DIR/usr/bin/dart"

      "$INSTALL_DIR/usr/bin/flutter" doctor
    build-packages:
      - clang
      - cmake
      - curl
      - libgtk-3-dev
      - ninja-build
      - unzip
      - xz-utils
      - zip
    override-prime: ''

  rechainonline:
    after: [flutter-git]
    plugin: nil
    source: .
    override-build: |
      set -eu
      STAGE_DIR="${CRAFT_STAGE:-$SNAPCRAFT_PART_INSTALL}"
      export PATH="$PATH:$STAGE_DIR/usr/bin"

      # Clean previous build
      rm -rf build

      # Use flutter from installed flutter-git
      flutter build linux --release -v

      mkdir -p "$CRAFT_PART_INSTALL/bin"
      cp -r build/linux/*/release/bundle/* "$CRAFT_PART_INSTALL/bin/"
    build-packages:
      - libsecret-1-dev
      - libjsoncpp-dev
      - libssl-dev
      - curl
      - libpciaccess-dev
    build-snaps:
      - rustup
    stage-packages:
      - libsecret-1-0
      - libjsoncpp1
      - libpciaccess0
      - libssl3
      - libssl-dev

slots:
  dbus-svc:
    interface: dbus
    bus: session
    name: com.rechain.online

apps:
  rechainonline:
    command: bin/rechainonline
    plugs:
      - audio-playback
      - desktop
      - desktop-legacy
      - home
      - network
      - network-manager
      - network-manager-observe
      - opengl
      - removable-media
      - browser-support
      - password-manager-service
    slots:
      - dbus-svc
    environment:
      XDG_DATA_HOME: $SNAP_USER_DATA
      XDG_DATA_DIRS: $SNAP/usr/share
      GDK_GL: gles
      LD_LIBRARY_PATH: "$LD_LIBRARY_PATH:$SNAP/lib:$SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET"
